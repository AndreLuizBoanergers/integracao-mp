<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>

<body>
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <script>
    const mp = new MercadoPago("TEST-f5875d02-0aac-4794-bd89-0e44ab04de11");;
  </script>

  <div>
    
  <form id="form-checkout" action="/process_payment" method="post">
    <div>
      <div>
        <label for="payerFirstName">Nome</label>
        <input id="form-checkout__payerFirstName" name="payerFirstName" type="text">
      </div>
      <div>
        <label for="payerLastName">Sobrenome</label>
        <input id="form-checkout__payerLastName" name="payerLastName" type="text">
      </div>
      <div>
        <label for="email">E-mail</label>
        <input id="form-checkout__email" name="email" type="text">
      </div>
      <div>
        <label for="identificationType">Tipo de documento</label>
        <select id="form-checkout__identificationType" name="identificationType" type="text"></select>
      </div>
      <div>
        <label for="identificationNumber">Número do documento</label>
        <input id="form-checkout__identificationNumber" name="identificationNumber" type="text">
      </div>
    </div>

    <div>
      <div>
        <input type="hidden" name="transactionAmount" id="transactionAmount" value="100">
        <input type="hidden" name="description" id="description" value="Nome do Produto">
        <br>
        <button type="submit">Pagar</button>
      </div>
    </div>
  </form>

  </div>
  <script type="text/javascript">
    
      (async function getIdentificationTypes() {
        try {
          const identificationTypes = await mp.getIdentificationTypes();
          const identificationTypeElement = document.getElementById('form-checkout__identificationType');

          createSelectOptions(identificationTypeElement, identificationTypes);
        } catch (e) {
          return console.error('Error getting identificationTypes: ', e);
        }
      })();

      function createSelectOptions(elem, options, labelsAndKeys = { label: "name", value: "id" }) {
        const { label, value } = labelsAndKeys;

        elem.options.length = 0;

        const tempOptions = document.createDocumentFragment();

        options.forEach(option => {
          const optValue = option[value];
          const optLabel = option[label];

          const opt = document.createElement('option');
          opt.value = optValue;
          opt.textContent = optLabel;

          tempOptions.appendChild(opt);
        });

        elem.appendChild(tempOptions);
      }
      /*
       async  function MP(postData = {}){
           const response = fetch('https://api.mercadopago.com/v1/payments',{
              method: "POST",
              headers: {
                'accept': 'application/json',
                'content-type': 'application/json',
                'Authorization': 'Bearer TEST-372315451099371-082121-4c3f271dead4147b86b225e552ff9d7c-326963184'
              },
              body: JSON.stringify(postData)
          });
          return response;
        }
        

        const jsonPost = '{"transaction_amount": 100, "description": "Título do produto","payment_method_id": "pix","payer": {"email": "PAYER_EMAIL","first_name": "Test","last_name": "User","identification": {"type": "CPF","number": "19119119100"},"address": {"zip_code": "06233200","street_name": "Av. das Nações Unidas","street_number": "3003","neighborhood": "Bonfim","city": "Osasco","federal_unit": "SP"}}}';
      MP(jsonPost).then((data)=>{
        console.log(data);
      })
      */
  </script>

  <?php
$post = '{
      "transaction_amount": 100,
      "description": "Título do produto",
      "payment_method_id": "pix",
      "payer": {
        "email": "PAYER_EMAIL@teste.com",
        "first_name": "Test",
        "last_name": "User",
        "identification": {
            "type": "CPF",
            "number": "19119119100"
        },
        "address": {
            "zip_code": "06233200",
            "street_name": "Av. das Nações Unidas",
            "street_number": "3003",
            "neighborhood": "Bonfim",
            "city": "Osasco",
            "federal_unit": "SP"
        }
      }
    }';
$ch = curl_init();
   curl_setopt($ch, CURLOPT_URL, 'https://api.mercadopago.com/v1/payments');
   curl_setopt($ch, CURLOPT_POST, 1);
   curl_setopt($ch, CURLOPT_HTTPHEADER, array(
      'accept: application/json',
      'content-type: application/json',
      'Authorization: Bearer TEST-372315451099371-082121-4c3f271dead4147b86b225e552ff9d7c-326963184'
   ));
   curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
   curl_setopt($ch, CURLOPT_POSTFIELDS, $post);
$response = curl_exec($ch);


echo "<br>";

$data = json_decode($response);
echo "<pre>";
//var_dump($data);
$qrCode = $data->point_of_interaction->transaction_data->qr_code_base64;
$copyCola = $data->point_of_interaction->transaction_data->qr_code;
echo "<br>";
echo "<img src='data:image/jpeg;base64,".$qrCode."' width='150'/>";
echo "<br>";
echo   '<label for="copiar">Copiar Hash:</label>';
echo  '<input type="text" id="copiar"  value='.$copyCola.'/>';

?>

</body>

</html>
